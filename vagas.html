<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciar Vagas - Painel Administrativo</title>
    
    <!-- CSS Frameworks -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">

    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#3B82F6",
                        "primary-hover": "#2563EB",
                        "accent": "#8B5CF6",
                        "bg-dark": "#030712",
                        "surface-dark": "#0F172A",
                        "surface-elevated": "#1E293B",
                        "border-dark": "#334155",
                        "text-main": "#F1F5F9",
                        "text-dim": "#94A3B8",
                        "success": "#10B981",
                        "warning": "#F59E0B",
                        "danger": "#EF4444",
                    },
                    fontFamily: {
                        "sans": ["Plus Jakarta Sans", "Inter", "sans-serif"],
                        "mono": ["JetBrains Mono", "monospace"]
                    },
                    boxShadow: {
                        'glow-primary': '0 0 20px rgba(59, 130, 246, 0.15)',
                        'glow-accent': '0 0 20px rgba(139, 92, 246, 0.15)',
                    }
                },
            },
        }
    </script>

    <style type="text/tailwindcss">
        @layer base {
            body { 
                @apply bg-bg-dark text-text-main font-sans antialiased selection:bg-primary/30;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { @apply bg-transparent; }
        ::-webkit-scrollbar-thumb { @apply bg-border-dark rounded-full hover:bg-primary/50 transition-colors; }

        /* Glassmorphism */
        .glass { @apply backdrop-blur-md bg-surface-dark/80 border border-white/5; }
        .glass-elevated { @apply backdrop-blur-xl bg-surface-elevated/90 border border-white/10; }

        /* Sidebar Styles */
        .sidebar-item {
            @apply flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-300 text-text-dim hover:text-white hover:bg-white/5;
        }
        .sidebar-item.active {
            @apply bg-primary/10 text-primary border border-primary/20 shadow-glow-primary;
        }

        /* Card Styles */
        .metric-card {
            @apply glass p-6 rounded-2xl transition-all duration-500 hover:-translate-y-1 hover:border-primary/30 hover:shadow-glow-primary;
        }

        /* Table Styles */
        .table-row {
            @apply transition-colors duration-200 hover:bg-white/[0.02];
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }

        /* Material Symbols Fix */
        .material-symbols-rounded {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        /* Dropdown Customization */
        .user-dropdown-menu {
            @apply absolute right-0 mt-2 w-48 glass-elevated rounded-2xl py-2 shadow-2xl opacity-0 invisible translate-y-2 transition-all duration-200 z-[100];
        }
        .user-menu-container:hover .user-dropdown-menu {
            @apply opacity-100 visible translate-y-0;
        }
    </style>

    <style>
        .brand-bolt-wrap {
            position: relative;
        }
        .brand-bolt-wrap::after {
            content: "";
            position: absolute;
            inset: -6px;
            border-radius: 18px;
            background: radial-gradient(circle at 40% 30%, rgba(250, 204, 21, 0.85), rgba(250, 204, 21, 0.25) 45%, rgba(250, 204, 21, 0) 70%);
            filter: blur(10px);
            opacity: 0.0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        .brand-bolt-wrap:hover::after {
            opacity: 1;
        }
        .brand-bolt {
            color: #facc15;
            filter: drop-shadow(0 0 10px rgba(250, 204, 21, 0.9)) drop-shadow(0 0 22px rgba(250, 204, 21, 0.7));
            transition: transform 0.3s ease, filter 0.3s ease;
        }
        .brand-bolt-wrap:hover .brand-bolt {
            transform: scale(1.18) rotate(-2deg);
            filter: drop-shadow(0 0 16px rgba(250, 204, 21, 1)) drop-shadow(0 0 34px rgba(250, 204, 21, 0.85));
        }
    </style>


    <style>
        .brand-bolt-wrap::after { display: none; }
        .brand-initials {
            font-weight: 800;
            font-size: 0.9rem;
            letter-spacing: 0.12em;
            color: #e2e8f0;
            text-transform: uppercase;
        }
    </style>

</head>
<body class="flex h-screen overflow-hidden">
    <!-- Sidebar -->
    <aside class="w-72 glass border-r border-border-dark flex flex-col p-6 z-50" data-sidebar-active="vagas">
        <div class="flex items-center gap-4 mb-10 px-2">
            <div>
                <h1 class="font-extrabold text-lg tracking-tight bg-gradient-to-r from-white to-text-dim bg-clip-text text-transparent">UltraRH</h1>
                <p class="text-[10px] font-bold uppercase tracking-[0.2em] text-primary">Admin Panel</p>
            </div>
        </div>

                <nav id="sidebar-links" class="flex-1 space-y-2 overflow-y-auto pr-2">
        </nav>


        <div class="mt-auto pt-6 border-t border-border-dark space-y-2">
            <button onclick="cleanupCandidates()" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-text-dim hover:text-danger hover:bg-danger/5 transition-all text-sm font-medium">
                <span class="material-symbols-rounded">delete_sweep</span>
                Limpar Expirados
            </button>
            <button onclick="logout()" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-text-dim hover:text-white hover:bg-white/5 transition-all text-sm font-medium">
                <span class="material-symbols-rounded">logout</span>
                Sair do Sistema
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col min-w-0 bg-bg-dark relative overflow-hidden">
        <!-- Background Glows -->
        <div class="absolute top-[-10%] right-[-10%] w-[500px] h-[500px] bg-primary/5 rounded-full blur-[120px] pointer-events-none"></div>
        <div class="absolute bottom-[-10%] left-[-10%] w-[500px] h-[500px] bg-accent/5 rounded-full blur-[120px] pointer-events-none"></div>

        <!-- Header -->
        <header class="h-20 glass border-b border-border-dark flex items-center justify-between px-8 z-40">
            <div class="flex items-center gap-6">
                <div class="flex flex-col">
                    <div class="flex items-center gap-2">
                        <h2 id="user-greeting" class="text-sm font-bold text-white">Bom dia, Jeferson</h2>
                        <span class="text-xs text-text-dim">|</span>
                        <span id="current-time" class="text-xs font-mono text-primary font-bold">10:02:54</span>
                    </div>
                    <div class="flex items-center gap-2 mt-1">
                        <span class="w-2 h-2 rounded-full bg-success animate-pulse"></span>
                        <span class="text-[10px] font-mono text-text-dim uppercase tracking-wider">Sistema Online</span>
                    </div>
                </div>
            </div>

            <div class="flex items-center gap-6">
                <div class="relative user-menu-container">
                    <div class="flex items-center gap-3 pl-6 border-l border-border-dark cursor-pointer group">
                        <div class="text-right hidden sm:block">
                            <p id="user-name-display" class="text-xs font-bold text-white group-hover:text-primary transition-colors">Jeferson</p>
                            <p id="user-role-display" class="text-[10px] text-text-dim font-mono uppercase">Desenvolvedor</p>
                        </div>
                        <div class="w-10 h-10 rounded-xl bg-surface-elevated border border-border-dark flex items-center justify-center overflow-hidden group-hover:border-primary transition-all">
                            <img id="user-avatar" src="https://ui-avatars.com/api/?name=Jeferson&background=0F172A&color=3B82F6" alt="Jeferson">
                        </div>
                        <span class="material-symbols-rounded text-text-dim group-hover:text-white transition-colors">expand_more</span>
                    </div>
                    <div class="user-dropdown-menu">
                        <div class="px-4 py-3 border-b border-white/5">
                            <p class="text-[10px] font-bold text-text-dim uppercase tracking-widest">Conta</p>
                        </div>
                        <a href="perfil.html" class="flex items-center gap-3 px-4 py-2.5 text-sm text-text-dim hover:text-white hover:bg-white/5 transition-all">
                            <span class="material-symbols-rounded text-lg">person</span>
                            Meu Perfil
                        </a>
                        <a href="configuracoes.html" class="flex items-center gap-3 px-4 py-2.5 text-sm text-text-dim hover:text-white hover:bg-white/5 transition-all">
                            <span class="material-symbols-rounded text-lg">settings</span>
                            Configurações
                        </a>
                        <div class="h-px bg-white/5 my-1"></div>
                        <button onclick="logout()" class="w-full flex items-center gap-3 px-4 py-2.5 text-sm text-danger hover:bg-danger/5 transition-all">
                            <span class="material-symbols-rounded text-lg">logout</span>
                            Sair da Conta
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Scrollable Content -->
        <div class="flex-1 overflow-y-auto p-8 space-y-8">
            <!-- Metrics Section -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="metric-card animate-fade-in" style="animation-delay: 0.1s">
                    <div class="flex justify-between items-start mb-4">
                        <div class="p-3 rounded-xl bg-success/10 text-success">
                            <span class="material-symbols-rounded">check_circle</span>
                        </div>
                        <span class="text-[10px] font-bold text-success bg-success/10 px-2 py-1 rounded-full uppercase">Ativas</span>
                    </div>
                    <h3 class="text-text-dim text-xs font-bold uppercase tracking-wider">Vagas Ativas</h3>
                    <p id="metric-active" class="text-4xl font-extrabold mt-2 font-mono">0</p>
                </div>

                <div class="metric-card animate-fade-in" style="animation-delay: 0.2s">
                    <div class="flex justify-between items-start mb-4">
                        <div class="p-3 rounded-xl bg-warning/10 text-warning">
                            <span class="material-symbols-rounded">pause_circle</span>
                        </div>
                        <span class="text-[10px] font-bold text-warning bg-warning/10 px-2 py-1 rounded-full uppercase">Pausadas</span>
                    </div>
                    <h3 class="text-text-dim text-xs font-bold uppercase tracking-wider">Vagas Inativas</h3>
                    <p id="metric-inactive" class="text-4xl font-extrabold mt-2 font-mono">0</p>
                </div>

                <div class="metric-card animate-fade-in" style="animation-delay: 0.3s">
                    <div class="flex justify-between items-start mb-4">
                        <div class="p-3 rounded-xl bg-primary/10 text-primary">
                            <span class="material-symbols-rounded">database</span>
                        </div>
                        <span class="text-[10px] font-bold text-primary bg-primary/10 px-2 py-1 rounded-full uppercase">Total</span>
                    </div>
                    <h3 class="text-text-dim text-xs font-bold uppercase tracking-wider">Total de Vagas</h3>
                    <p id="metric-total" class="text-4xl font-extrabold mt-2 font-mono">0</p>
                </div>
            </div>

            <!-- Table Section -->
            <div class="glass rounded-3xl overflow-hidden animate-fade-in" style="animation-delay: 0.4s">
                <!-- Toolbar -->
                <div class="p-6 border-b border-border-dark flex flex-col sm:flex-row justify-between items-center gap-4">
                    <div class="flex bg-bg-dark/50 p-1 rounded-xl border border-border-dark">
                        <button class="status-filter-btn active px-6 py-2 rounded-lg text-xs font-bold transition-all" data-status-filter="">TODAS</button>
                        <button class="status-filter-btn px-6 py-2 rounded-lg text-xs font-bold text-text-dim hover:text-white transition-all" data-status-filter="ativa">ATIVAS</button>
                        <button class="status-filter-btn px-6 py-2 rounded-lg text-xs font-bold text-text-dim hover:text-white transition-all" data-status-filter="inativa">INATIVAS</button>
                    </div>

                    <div class="flex items-center gap-3">
                        <button onclick="loadVagas()" class="p-2.5 rounded-xl border border-border-dark hover:bg-white/5 text-text-dim hover:text-white transition-all" title="Atualizar Dados">
                            <span class="material-symbols-rounded text-xl">refresh</span>
                        </button>
                        <button onclick="location.href='nova-vaga.html'" class="flex items-center gap-2 bg-primary hover:bg-primary-hover text-white px-6 py-2.5 rounded-xl text-xs font-bold transition-all shadow-glow-primary">
                            <span class="material-symbols-rounded text-lg">add</span>
                            NOVA VAGA
                        </button>
                    </div>
                </div>

                <!-- Table Content -->
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-white/[0.02]">
                                <th class="px-8 py-5 text-[10px] font-bold text-text-dim uppercase tracking-widest">Informações da Vaga</th>
                                <th class="px-8 py-5 text-[10px] font-bold text-text-dim uppercase tracking-widest">Status</th>
                                <th class="px-8 py-5 text-[10px] font-bold text-text-dim uppercase tracking-widest">Candidatos</th>
                                <th class="px-8 py-5 text-[10px] font-bold text-text-dim uppercase tracking-widest text-right">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="vagas-table" class="divide-y divide-border-dark/50">
                            <!-- Dynamic Content -->
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="p-6 bg-white/[0.01] border-t border-border-dark flex flex-col sm:flex-row justify-between items-center gap-4">
                    <div class="flex items-center gap-4 text-[10px] font-mono text-text-dim">
                        <span id="show-count-text">EXIBINDO: 0 / TOTAL: 0</span>
                        <div class="h-4 w-px bg-border-dark"></div>
                        <span id="page-info">PÁGINA 0 DE 0</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="pagination-prev" class="px-4 py-2 rounded-lg border border-border-dark text-[10px] font-bold hover:bg-white/5 disabled:opacity-30 disabled:cursor-not-allowed transition-all">ANTERIOR</button>
                        <button id="pagination-next" class="px-4 py-2 rounded-lg border border-border-dark text-[10px] font-bold hover:bg-white/5 disabled:opacity-30 disabled:cursor-not-allowed transition-all">PRÓXIMO</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal Editar Vaga -->
    <div class="modal fade" id="editVagaModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content glass-elevated border-white/10 rounded-[2rem] overflow-hidden">
                <div class="modal-header border-b border-white/5 p-8">
                    <h5 class="text-xl font-bold text-white">Editar Detalhes da Vaga</h5>
                    <button type="button" class="text-text-dim hover:text-white transition-colors" data-bs-dismiss="modal">
                        <span class="material-symbols-rounded">close</span>
                    </button>
                </div>
                <div class="modal-body p-8">
                    <form id="edit-vaga-form" class="space-y-6">
                        <input type="hidden" id="edit-vaga-id">
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-text-dim uppercase tracking-wider">Nome da Vaga</label>
                            <input type="text" id="edit-vaga-nome" 
                                   class="w-full bg-bg-dark/50 border border-border-dark rounded-xl py-3 px-4 text-sm focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all" required>
                        </div>
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-text-dim uppercase tracking-wider">Status Operacional</label>
                            <select id="edit-vaga-status" 
                                    class="w-full bg-bg-dark/50 border border-border-dark rounded-xl py-3 px-4 text-sm focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all">
                                <option value="ativa">Ativa (Recebendo Candidatos)</option>
                                <option value="inativa">Inativa (Pausada)</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-t border-white/5 p-8 flex gap-3">
                    <button type="button" class="flex-1 py-3 rounded-xl border border-border-dark text-sm font-bold hover:bg-white/5 transition-all" data-bs-dismiss="modal">CANCELAR</button>
                    <button type="button" id="save-vaga-btn" onclick="saveVagaChanges()" 
                            class="flex-1 py-3 rounded-xl bg-primary hover:bg-primary-hover text-white text-sm font-bold transition-all shadow-glow-primary">
                        SALVAR ALTERAÇÕES
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="scripts/sidebar.js"></script>
         <script src="scripts/aton-widget.js" defer></script>
    <script src="scripts/admin-common.js"></script>
    <script src="scripts/vagas.js"></script>
    
    <script>
        // Lógica de Usuário e Tempo Real
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-BR', { hour12: false });
            const timeElement = document.getElementById('current-time');
            if (timeElement) timeElement.textContent = timeString;
        }

        function getGreeting() {
            const hour = new Date().getHours();
            if (hour >= 5 && hour < 12) return "Bom dia";
            if (hour >= 12 && hour < 18) return "Boa tarde";
            return "Boa noite";
        }

        function getStoredUserData() {
            const rawUser = localStorage.getItem('admin_user') || localStorage.getItem('user');
            if (!rawUser) return {};
            try {
                return JSON.parse(rawUser) || {};
            } catch {
                return {};
            }
        }

        function buildAvatarUrl(name, fallback) {
            if (fallback) return fallback;
            const encoded = encodeURIComponent(name.trim() || "Usuário");
            return `https://ui-avatars.com/api/?name=${encoded}&background=0F172A&color=3B82F6`;
        }

        function setupUserHeader() {
            const userData = getStoredUserData();
            const userName = (userData.nome || userData.name || userData.email || "Administrador").trim();
            const userRole = (userData.funcao || userData.role || "Root Access").trim();
            const avatarSource = buildAvatarUrl(userName, userData.avatar || userData.avatar_url || userData.foto || userData.photo);

            const greetingElement = document.getElementById('user-greeting');
            if (greetingElement) greetingElement.textContent = `${getGreeting()}, ${userName}`;
            const nameElement = document.getElementById('user-name-display');
            if (nameElement) nameElement.textContent = userName;
            const roleElement = document.getElementById('user-role-display');
            if (roleElement) roleElement.textContent = userRole;
            const avatarImg = document.getElementById('user-avatar');
            if (avatarImg) {
                avatarImg.src = avatarSource;
                avatarImg.alt = userName;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            updateClock();
            setInterval(updateClock, 1000);
            setupUserHeader();
        });

        // Otimização das Funções Existentes
        const searchInput = document.getElementById('search-vagas');
        const placeholders = ['Pesquisar por cargo...', 'Filtrar por departamento...', 'Buscar ID da vaga...'];
        let pIdx = 0, cIdx = 0, isDel = false;
        
        function typeEffect() {
            const current = placeholders[pIdx];
            if (searchInput) {
                searchInput.placeholder = isDel ? current.substring(0, cIdx--) : current.substring(0, cIdx++);
                if (!isDel && cIdx > current.length) { isDel = true; setTimeout(typeEffect, 2000); }
                else if (isDel && cIdx < 0) { isDel = false; pIdx = (pIdx + 1) % placeholders.length; setTimeout(typeEffect, 500); }
                else { setTimeout(typeEffect, isDel ? 40 : 80); }
            }
        }
        typeEffect();

        const statusButtons = document.querySelectorAll(".status-filter-btn");
        statusButtons.forEach(button => {
            button.addEventListener("click", () => {
                statusButtons.forEach(btn => {
                    btn.classList.remove("bg-primary", "text-white", "shadow-glow-primary", "active");
                    btn.classList.add("text-text-dim");
                });
                button.classList.add("bg-primary", "text-white", "shadow-glow-primary", "active");
                button.classList.remove("text-text-dim");
                const status = button.dataset.statusFilter || "";
                if (window.loadVagas) window.loadVagas(status);
            });
        });

        const originalSaveVagaChanges = window.saveVagaChanges;
        window.saveVagaChanges = async function() {
            const btn = document.getElementById('save-vaga-btn');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = `<div class="flex items-center justify-center gap-2"><svg class="animate-spin h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>PROCESSANDO...</div>`;
            btn.disabled = true;
            try {
                if (typeof originalSaveVagaChanges === 'function') await originalSaveVagaChanges();
                else await new Promise(r => setTimeout(r, 1000));
                btn.innerHTML = '<span class="material-symbols-rounded">check_circle</span> SUCESSO!';
                btn.classList.replace('bg-primary', 'bg-success');
                setTimeout(() => {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('editVagaModal'));
                    if (modal) modal.hide();
                    setTimeout(() => {
                        btn.innerHTML = originalHTML;
                        btn.classList.replace('bg-success', 'bg-primary');
                        btn.disabled = false;
                    }, 500);
                }, 1000);
            } catch (error) {
                btn.innerHTML = '<span class="material-symbols-rounded">error</span> ERRO AO SALVAR';
                btn.classList.replace('bg-primary', 'bg-danger');
                setTimeout(() => { btn.innerHTML = originalHTML; btn.classList.replace('bg-danger', 'bg-primary'); btn.disabled = false; }, 2000);
            }
        };

        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.addedNodes.length) {
                    mutation.addedNodes.forEach(node => {
                        if (node.tagName === 'TR') {
                            node.classList.add('table-row', 'animate-fade-in');
                            const cells = node.querySelectorAll('td');
                            if (cells.length > 0) {
                                cells[0].classList.add('px-8', 'py-5');
                                cells[1].classList.add('px-8', 'py-5');
                                cells[2].classList.add('px-8', 'py-5', 'font-mono', 'text-xs');
                                cells[3].classList.add('px-8', 'py-5', 'text-right');
                            }
                        }
                    });
                }
            });
        });
        const tableBody = document.getElementById('vagas-table');
        if (tableBody) observer.observe(tableBody, { childList: true });
    </script>
</body>
</html>
